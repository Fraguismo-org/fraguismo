{% extends 'base.html' %}
{% load static %}

{% block content %}
<section class="py-4">
    <div class="shadow p-4 mb-5 bg-body rounded">

        <div class="text-center mb-4">
            <p class="text-uppercase text-muted fw-semibold small mb-1">Ranking</p>
            <h2 class="h2 fw-semibold mb-2">Ranking da Liberdade</h2>
            <p class="text-muted mb-0">
                Ranking baseado em pontuação total e filtros por período.
            </p>
        </div>

        <!-- FILTROS -->
        <form class="mb-4" method="GET" action="{% url 'ranking_liberdade' %}">
            <div class="row g-2 justify-content-center">

                <!-- BUSCA -->
                <div class="col-12 col-md-6 col-lg-4">
                    <input
                        class="form-control"
                        type="text"
                        name="q"
                        value="{{ busca|default:'' }}"
                        placeholder="Buscar por nome, e-mail ou username">
                </div>

                <!-- PERÍODO -->
                <div class="col-12 col-md-3 col-lg-2">
                    <select name="periodo" class="form-select">
                        <option value="">todos</option>
                        <option value="7d" {% if periodo == "7d" %}selected{% endif %}>
                            últimos 7 dias
                        </option>
                        <option value="30d" {% if periodo == "30d" %}selected{% endif %}>
                            últimos 30 dias
                        </option>
                    </select>
                </div>

                <!-- BOTÃO -->
                <div class="col-12 col-md-2 col-lg-1 d-grid">
                    <button class="btn btn-primary" type="submit">
                        <i class="bi bi-search"></i>
                    </button>
                </div>

            </div>
        </form>

        {% if busca or periodo %}
        <p class="text-center text-muted small">
            filtros ativos:
            {% if busca %}
                <strong>"{{ busca }}"</strong>
            {% endif %}
            {% if periodo %}
                <span class="mx-1">•</span>
                <strong>
                    {% if periodo == "7d" %}últimos 7 dias{% elif periodo == "30d" %}últimos 30 dias{% endif %}
                </strong>
            {% endif %}
        </p>
        {% endif %}

        <!-- TABELA -->
        <div class="mt-4">
            {% include 'partials/ranking_table.html' with ranking=ranking empty_message='Nenhum fraguista encontrado.' %}
        </div>

        <!-- OBS -->
        <div class="row text-muted small mt-3">
            {% if periodo == "7d" %}
            <div class="col text-center">
                considerando pontuação dos últimos 7 dias.
            </div>
            {% elif periodo == "30d" %}
            <div class="col text-center">
                considerando pontuação dos últimos 30 dias.
            </div>
            {% else %}
            <div class="col text-center">
                exibindo ranking geral.
            </div>
            {% endif %}
        </div>

    </div>
</section>
{% endblock content %}
